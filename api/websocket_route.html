

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>\Can\Server\WebSocketRoute API &mdash; PHP Can 0.3.0 documentation</title>
    
    <link rel="stylesheet" href="../static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="top" title="PHP Can 0.3.0 documentation" href="../index.html" />
    <link rel="next" title="\Can\Server\WebSocketConnection API" href="websocket_connection.html" />
    <link rel="prev" title="\Can\Server\Route API" href="route.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../php-modindex.html" title="PHP Namespace Index"
             >namespaces</a> |</li>
        <li class="right" >
          <a href="websocket_connection.html" title="\Can\Server\WebSocketConnection API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="route.html" title="\Can\Server\Route API"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">PHP Can 0.3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="route.html"
                        title="previous chapter"><tt class="docutils literal docutils literal docutils literal"><span class="pre">\Can\Server\Route</span></tt> API</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="websocket_connection.html"
                        title="next chapter"><tt class="docutils literal docutils literal docutils literal"><span class="pre">\Can\Server\WebSocketConnection</span></tt> API</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../sources/api/websocket_route.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="namespace-Can\Server">
<span id="can-server-websocketroute-api"></span><span id="php-can-websocket-route"></span><h1><tt class="docutils literal"><span class="pre">\Can\Server\WebSocketRoute</span></tt> API<a class="headerlink" href="#namespace-Can\Server" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Can\Server\WebSocketRoute">
<em class="property">class </em><tt class="descname">WebSocketRoute</tt><a class="headerlink" href="#Can\Server\WebSocketRoute" title="Permalink to this definition">¶</a></dt>
<dd><p>WebSocketRoute class.</p>
</dd></dl>

<dl class="method">
<dt id="Can\Server\WebSocketRoute::__construct">
<tt class="descclassname">Can\Server\WebSocketRoute::</tt><tt class="descname">__construct</tt><big>(</big><em>string $uri</em>, <em>callable $handler</em><big>)</big><a class="headerlink" href="#Can\Server\WebSocketRoute::__construct" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor. Instantiates new Server WebSocket route.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>$uri</strong> (<em>string</em>) &#8211; Static or dynamic URI path.</li>
<li><strong>$handler</strong> (<em>callable</em>) &#8211; onMessage handler - any valid PHP callback</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Throws :</th><td class="field-body"><ul class="first last simple">
<li><tt class="xref php php-class docutils literal"><span class="pre">InvalidParametersException</span></tt> If invalid parameters are passed to the method.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The onMessage handler must accepting <tt class="docutils literal"><span class="pre">string</span></tt> message as first parameter and <a class="reference internal" href="websocket_connection.html#Can\Server\WebSocketConnection" title="Can\Server\WebSocketConnection"><tt class="xref php php-class docutils literal"><span class="pre">WebSocketConnection</span></tt></a> instance as second parameter
which you can use to communicate with the WebSocket client. See <a class="reference internal" href="../howto.html#tutorial-websockets"><em>WebSockets</em></a> for detailed information.</p>
</dd></dl>

<p>Example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Can\Server\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\Server\WebSocketRoute</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\Server\WebSocketConnection</span><span class="p">;</span>

<span class="nv">$route</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocketRoute</span><span class="p">(</span>
    <span class="s1">&#39;/hello&#39;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nx">WebSocketConnection</span> <span class="nv">$conn</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s1">&#39;Hello, your message was &#39;</span> <span class="o">.</span>  <span class="nv">$message</span> <span class="o">.</span> <span class="s1">&#39;!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<dl class="method">
<dt id="Can\Server\WebSocketRoute::beforeHandshake">
<tt class="descclassname">Can\Server\WebSocketRoute::</tt><tt class="descname">beforeHandshake</tt><big>(</big><em>Request $request</em>, <em>array $args</em>, <em>WebSocketConnection $conn</em><big>)</big><a class="headerlink" href="#Can\Server\WebSocketRoute::beforeHandshake" title="Permalink to this definition">¶</a></dt>
<dd><p>This method will be invoked before WebSocket handshake will be sent to the client. By default this method do
nothing. You must extend WebSocketRoute class to override this method with your logic, e.g. examine Request
headers or values of the wildcards defined within you URI path, add additional response headers or decline
the connection by throwing <tt class="xref php php-class docutils literal"><span class="pre">HTTPError</span></tt> exception. Although WebSocketConnection instance already
exists the real WebSocket connection is not established yet, so it makes no sense to call WebSocketConnection::send()
or WebSocketConnection::close() at this time.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>$request</strong> (<em>Request</em>) &#8211; <a class="reference internal" href="request.html#Can\Server\Request" title="Can\Server\Request"><tt class="xref php php-class docutils literal"><span class="pre">Request</span></tt></a> instance.</li>
<li><strong>$args</strong> (<em>array</em>) &#8211; associative arguments array with values of the wildcards defined within URI path.</li>
<li><strong>$conn</strong> (<em>WebSocketConnection</em>) &#8211; Instance of <a class="reference internal" href="websocket_connection.html#Can\Server\WebSocketConnection" title="Can\Server\WebSocketConnection"><tt class="xref php php-class docutils literal"><span class="pre">WebSocketConnection</span></tt></a>, WebSocket connection associated with this request.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Can\Server\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\Server\WebSocketRoute</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\Server\WebSocketConnection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\HTTPError</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyWebSocketRoute</span> <span class="k">extends</span> <span class="nx">WebSocketRoute</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">beforeHandshake</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$args</span><span class="p">,</span> <span class="nx">WebSocketConnection</span> <span class="nv">$conn</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">addResponseHeader</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="s1">&#39;Bar&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">HTTPError</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;Expecting foo..&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$route</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyWebSocketRoute</span><span class="p">(</span>
    <span class="s1">&#39;/&lt;name&gt;&#39;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nx">WebSocketConnection</span> <span class="nv">$conn</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s1">&#39;Hello, your message was &#39;</span> <span class="o">.</span>  <span class="nv">$message</span> <span class="o">.</span> <span class="s1">&#39;!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<dl class="method">
<dt id="Can\Server\WebSocketRoute::afterHandshake">
<tt class="descclassname">Can\Server\WebSocketRoute::</tt><tt class="descname">afterHandshake</tt><big>(</big><em>WebSocketConnection $conn</em><big>)</big><a class="headerlink" href="#Can\Server\WebSocketRoute::afterHandshake" title="Permalink to this definition">¶</a></dt>
<dd><p>This method will be invoked after WebSocket handshake sent to the client. By default this method do
nothing. You must extend WebSocketRoute class to override this method with your logic. At this time
the WebSocket connection already established, so you can send a message or close this connection.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>$conn</strong> (<em>WebSocketConnection</em>) &#8211; Instance of <a class="reference internal" href="websocket_connection.html#Can\Server\WebSocketConnection" title="Can\Server\WebSocketConnection"><tt class="xref php php-class docutils literal"><span class="pre">WebSocketConnection</span></tt></a>, WebSocket connection.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Can\Server\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\Server\WebSocketRoute</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\Server\WebSocketConnection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\HTTPError</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyWebSocketRoute</span> <span class="k">extends</span> <span class="nx">WebSocketRoute</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">afterHandshake</span><span class="p">(</span><span class="nx">WebSocketConnection</span> <span class="nv">$conn</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s1">&#39;Welcome, dude&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$route</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyWebSocketRoute</span><span class="p">(</span>
    <span class="s1">&#39;/&lt;name&gt;&#39;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nx">WebSocketConnection</span> <span class="nv">$conn</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s1">&#39;Hello, your message was &#39;</span> <span class="o">.</span>  <span class="nv">$message</span> <span class="o">.</span> <span class="s1">&#39;!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<dl class="method">
<dt id="Can\Server\WebSocketRoute::onMessage">
<tt class="descclassname">Can\Server\WebSocketRoute::</tt><tt class="descname">onMessage</tt><big>(</big><em>$message</em>, <em>WebSocketConnection $conn</em><big>)</big><a class="headerlink" href="#Can\Server\WebSocketRoute::onMessage" title="Permalink to this definition">¶</a></dt>
<dd><p>This method will be invoked on incoming messages from WebSocket connection $conn. Use given
WebSocketConnection to send a message to the client.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>$message</strong> (<em>string</em>) &#8211; Incoming WebSocket message.</li>
<li><strong>$conn</strong> (<em>WebSocketConnection</em>) &#8211; Instance of <a class="reference internal" href="websocket_connection.html#Can\Server\WebSocketConnection" title="Can\Server\WebSocketConnection"><tt class="xref php php-class docutils literal"><span class="pre">WebSocketConnection</span></tt></a>, WebSocket connection.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Can\Server\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\Server\WebSocketRoute</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\Server\WebSocketConnection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Can\HTTPError</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyWebSocketRoute</span> <span class="k">extends</span> <span class="nx">WebSocketRoute</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onMessage</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nx">WebSocketConnection</span> <span class="nv">$conn</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s1">&#39;Hello, your message was &#39;</span> <span class="o">.</span>  <span class="nv">$message</span> <span class="o">.</span> <span class="s1">&#39;!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$route</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyWebSocketRoute</span><span class="p">(</span><span class="s1">&#39;/&lt;name&gt;&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<dl class="method">
<dt id="Can\Server\WebSocketRoute::onClose">
<tt class="descclassname">Can\Server\WebSocketRoute::</tt><tt class="descname">onClose</tt><big>(</big><em>CanServerWebSocketConnection $conn</em><big>)</big><a class="headerlink" href="#Can\Server\WebSocketRoute::onClose" title="Permalink to this definition">¶</a></dt>
<dd><p>This method will be invoked if WebSocket connection $conn is closed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>$conn</strong> (<em>WebSocketConnection</em>) &#8211; Instance of <a class="reference internal" href="websocket_connection.html#Can\Server\WebSocketConnection" title="Can\Server\WebSocketConnection"><tt class="xref php php-class docutils literal"><span class="pre">WebSocketConnection</span></tt></a>, WebSocket connection.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../php-modindex.html" title="PHP Namespace Index"
             >namespaces</a> |</li>
        <li class="right" >
          <a href="websocket_connection.html" title="\Can\Server\WebSocketConnection API"
             >next</a> |</li>
        <li class="right" >
          <a href="route.html" title="\Can\Server\Route API"
             >previous</a> |</li>
        <li><a href="../index.html">PHP Can 0.3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2012, Dmitry Vinogradov &lt;dmitri.vinogradov@gmail.com&gt;.
      Last updated on Aug 12, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>
